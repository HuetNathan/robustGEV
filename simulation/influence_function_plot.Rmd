
R code for influence functions plots

```{r}

library(latex2exp)
library(ggplot2)
library(mev)

source("/functions/influence_function.R")

```

Plots influence functions for positive shape parameter (Figure 3)

```{r}

# Parameters

mu <- 0
sigma <- 1
xi <-0.3
alphas <- c(0.0, 0.1, 0.3, 0.5, 1.0)
```

```{r}

# plot influence function location parameter (Figure 3, left)

p <- c(0.001,0.1,0.5,0.8,0.9)
list_quantile <- mev::qgev(p, loc = mu, scale = sigma, shape = xi, lower.tail = TRUE, log.p = FALSE)

x_mu <- seq(mu - sigma/xi + 1.8, 4, by = 0.1)  

plot_data <- data.frame()

for (alpha in alphas) {
  y_vals <- IF_mu(x_mu, mu, sigma, xi, alpha)
  df <- data.frame(x = x_mu, y = y_vals, alpha = as.factor(alpha))
  plot_data <- rbind(plot_data, df)
}

plot_if <- ggplot(plot_data, aes(x = x, y = y, color = alpha)) +
  geom_line(size = 1.2) +
  theme_minimal()+
    scale_color_manual(
      values = c("0" = "#1b1a81",
                 "0.1" = "#7c2f9f",
                 "0.3" = "#c54ba0",
                 "0.5" = "#f3904e",
                 "1" = "#d1d84d"))+
  labs(
    x = TeX("$q$"),
    y = TeX("$\\textit{IF}_{\\alpha,\\mu}(q,\\mu_0,\\sigma_0,\\xi_0)$")
  ) +
  scale_x_continuous(
    breaks = list_quantile,
    labels = p
  ) +
  theme(legend.position = "none",
        legend.title=element_text(size=26,face="bold"),
        legend.text =element_text(size=24))+
  theme(
    axis.title = element_text(size = 24),   
    axis.text = element_text(size = 18)
  )
plot_if
```

```{r}
ggsave(plot = plot_if,
       filename = paste0("/simulation/figures/IF_mu_positive_xi.png"),
       width = 1760 / 180,
       height = 1060 / 180,
       dpi = 180,
       units = "in")

```

```{r}

# plot influence function scale parameter (Figure 3, middle)

p <- c(0.001,0.2,0.5,0.8,0.9)
list_quantile <- mev::qgev(p, loc = mu, scale = sigma, shape = xi, lower.tail = TRUE, log.p = FALSE)


x_sig <- seq(mu - sigma/xi + 1.6, 10, by = 0.1)  

plot_data <- data.frame()

for (alpha in alphas) {
  y_vals <- IF_sigma(x_sig, mu, sigma, xi, alpha)
  df <- data.frame(x = x_sig, y = y_vals, alpha = as.factor(alpha))
  plot_data <- rbind(plot_data, df)
}

plot_if <- ggplot(plot_data, aes(x = x, y = y, color = alpha)) +
  geom_line(size = 1.2) +
  theme_minimal() +
    scale_color_manual(
      values = c("0" = "#1b1a81",
                 "0.1" = "#7c2f9f",
                 "0.3" = "#c54ba0",
                 "0.5" = "#f3904e",
                 "1" = "#d1d84d"))+
  labs(
    x = TeX("$q$"),
    y = TeX("$\\textit{IF}_{\\alpha,\\sigma}(q,\\mu_0,\\sigma_0,\\xi_0)$")
  )+
  scale_x_continuous(
    breaks = list_quantile,
    labels = p
  ) +
  theme(legend.position ="none",
        legend.title=element_text(size=26,face="bold"),
        legend.text =element_text(size=24))+
  theme(
    axis.title = element_text(size = 24),   
    axis.text = element_text(size = 18)
  )
plot_if
```

```{r}
ggsave(plot = plot_if,
       filename = paste0("/simulation/figures/IF_sig_positive_xi.png"),
       width = 1760 / 180,
       height = 1060 / 180,
       dpi = 180,
       units = "in")

```

```{r}

# plot influence function shape parameter (Figure 2, right)

p <- c(0.001,0.1,0.5,0.8,0.9,0.95)
list_quantile <- mev::qgev(p, loc = mu, scale = sigma, shape = xi, lower.tail = TRUE, log.p = FALSE)

x_xi <- seq(mu - sigma/xi + 1.7, 7, by = 0.1)  

plot_data <- data.frame()

for (alpha in alphas) {
  y_vals <- IF_xi(x_xi, mu, sigma, xi, alpha)
  df <- data.frame(x = x_xi, y = y_vals, alpha = as.factor(alpha))
  plot_data <- rbind(plot_data, df)
}

plot_if <- ggplot(plot_data, aes(x = x, y = y, color = alpha)) +
  geom_line(size = 1.2) +
  theme_minimal() +
    scale_color_manual(
      values = c("0" = "#1b1a81",
                 "0.1" = "#7c2f9f",
                 "0.3" = "#c54ba0",
                 "0.5" = "#f3904e",
                 "1" = "#d1d84d"),
      name = expression(~~~~alpha))+
  labs(
    x = TeX("$q$"),
    y = TeX("$\\textit{IF}_{\\alpha,\\xi}(q,\\mu_0,\\sigma_0,\\xi_0)$")
  ) +
  scale_x_continuous(
    breaks = list_quantile,
    labels = p
  ) +
  #scale_y_log10() +
  theme(
    legend.position = c(.7, .3),
    legend.title = element_text(size = 26, face = "bold"),
    legend.text = element_text(size = 24),
    axis.title = element_text(size = 24),
    axis.text = element_text(size = 18)
  )
plot_if
```

```{r}
ggsave(plot = plot_if,
       filename = paste0("/simulation/figures/IF_xi_positive_xi.png"),
       width = 1760 / 180,
       height = 1060 / 180,
       dpi = 180,
       units = "in")

```

Plots influence functions for negative shape parameter (Figure 1)

```{r}

# Parameters

mu <- 0
sigma <- 1
xi <- -0.3
alphas <- c(0.0, 0.1, 0.3, 0.5, 1.0)
```

```{r}

# plot influence function location parameter (Figure 1, left)

p <- c(0.001,0.1,0.5,0.8,0.9)
list_quantile <- mev::qgev(p, loc = mu, scale = sigma, shape = xi, lower.tail = TRUE, log.p = FALSE)

x_mu <- seq(-3, mu - sigma/xi - 0.4, by = 0.1) 

plot_data <- data.frame()

for (alpha in alphas) {
  y_vals <- IF_mu(x_mu, mu, sigma, xi, alpha)
  df <- data.frame(x = x_mu, y = y_vals, alpha = as.factor(alpha))
  plot_data <- rbind(plot_data, df)
}

plot_if <- ggplot(plot_data, aes(x = x, y = y, color = alpha)) +
  geom_line(size = 1.2) +
  theme_minimal()+
    scale_color_manual(
      values = c("0" = "#1b1a81",
                 "0.1" = "#7c2f9f",
                 "0.3" = "#c54ba0",
                 "0.5" = "#f3904e",
                 "1" = "#d1d84d"))+
  labs(
    x = TeX("$q$"),
    y = TeX("$\\textit{IF}_{\\alpha,\\mu}(q,\\mu_0,\\sigma_0,\\xi_0)$")
  ) +
  scale_x_continuous(
    breaks = list_quantile,
    labels = p
  ) +
  theme(legend.position = "none",
        legend.title=element_text(size=26,face="bold"),
        legend.text =element_text(size=24))+
  theme(
    axis.title = element_text(size = 24),   
    axis.text = element_text(size = 18)
  )
plot_if
```

```{r}
ggsave(plot = plot_if,
       filename = paste0("/simulation/figures/IF_mu_negative_xi.png"),
       width = 1760 / 180,
       height = 1060 / 180,
       dpi = 180,
       units = "in")

```

```{r}

# plot influence function sclae parameter (Figure 1, middle)

p <- c(0.001,0.1,0.5,0.7,0.9)
list_quantile <- mev::qgev(p, loc = mu, scale = sigma, shape = xi, lower.tail = TRUE, log.p = FALSE)


x_sig <- seq(-3, mu - sigma/xi - 0.4, by = 0.1)  

plot_data <- data.frame()

for (alpha in alphas) {
  y_vals <- IF_sigma(x_sig, mu, sigma, xi, alpha)
  df <- data.frame(x = x_sig, y = y_vals, alpha = as.factor(alpha))
  plot_data <- rbind(plot_data, df)
}

plot_if <- ggplot(plot_data, aes(x = x, y = y, color = alpha)) +
  geom_line(size = 1.2) +
  theme_minimal() +
    scale_color_manual(
      values = c("0" = "#1b1a81",
                 "0.1" = "#7c2f9f",
                 "0.3" = "#c54ba0",
                 "0.5" = "#f3904e",
                 "1" = "#d1d84d"))+
  labs(
    x = TeX("$q$"),
    y = TeX("$\\textit{IF}_{\\alpha,\\sigma}(q,\\mu_0,\\sigma_0,\\xi_0)$")
  )+
  scale_x_continuous(
    breaks = list_quantile,
    labels = p
  ) +
  theme(legend.position ="none",
        legend.title=element_text(size=26,face="bold"),
        legend.text =element_text(size=24))+
  theme(
    axis.title = element_text(size = 24),   
    axis.text = element_text(size = 18)
  )
plot_if
```

```{r}
ggsave(plot = plot_if,
       filename = paste0("/simulation/figures/IF_sig_negative_xi.png"),
       width = 1760 / 180,
       height = 1060 / 180,
       dpi = 180,
       units = "in")

```


```{r}

# plot influence function location parameter (Figure 1, right)

p <- c(0.001,0.1,0.5,0.8,0.9)
list_quantile <- mev::qgev(p, loc = mu, scale = sigma, shape = xi, lower.tail = TRUE, log.p = FALSE)

x_xi <- seq(-4, mu - sigma/xi - 0.15, by = 0.1)  

plot_data <- data.frame()

for (alpha in alphas) {
  y_vals <- IF_xi(x_xi, mu, sigma, xi, alpha)
  df <- data.frame(x = x_xi, y = y_vals, alpha = as.factor(alpha))
  plot_data <- rbind(plot_data, df)
}

plot_if <- ggplot(plot_data, aes(x = x, y = y, color = alpha)) +
  geom_line(size = 1.2) +
  theme_minimal() +
    scale_color_manual(
      values = c("0" = "#1b1a81",
                 "0.1" = "#7c2f9f",
                 "0.3" = "#c54ba0",
                 "0.5" = "#f3904e",
                 "1" = "#d1d84d"),
      name = expression(~~~~alpha))+
  labs(
    x = TeX("$q$"),
    y = TeX("$\\textit{IF}_{\\alpha,\\xi}(q,\\mu_0,\\sigma_0,\\xi_0)$")
  ) +
  scale_x_continuous(
    breaks = list_quantile,
    labels = p
  ) +
  theme(
    legend.position = c(.3, .7),
    legend.title = element_text(size = 26, face = "bold"),
    legend.text = element_text(size = 24),
    axis.title = element_text(size = 24),
    axis.text = element_text(size = 18)
  )
plot_if
```

```{r}
ggsave(plot = plot_if,
       filename = paste0("C:/Users/huetn/Documents/github_repos/robustGEV/simulation/new_figures/IF_xi_negative_xi.png"),
       width = 1760 / 180,
       height = 1060 / 180,
       dpi = 180,
       units = "in")

```


